<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ramnog">
<title>Criteria Methods • ramnog</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Criteria Methods">
<meta property="og:description" content="ramnog">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ramnog</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ramnog.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Overview</h6>
    <a class="dropdown-item" href="../articles/ep_overview.html">Endpoint Specification</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Endpoint Population and Outcome Specification</h6>
    <a class="dropdown-item" href="../articles/ep_spec_adam_data.html">ADaM Data</a>
    <a class="dropdown-item" href="../articles/ep_spec_treatment_arms.html">Treatment Arms</a>
    <a class="dropdown-item" href="../articles/ep_spec_population_def.html">Analysis Population</a>
    <a class="dropdown-item" href="../articles/ep_spec_event_def.html">Endpoint Events</a>
    <a class="dropdown-item" href="../articles/ep_spec_strata_def.html">Strata</a>
    <a class="dropdown-item" href="../articles/ep_spec_label.html">Endpoint Label</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Endpoint Statistics</h6>
    <a class="dropdown-item" href="../articles/methods_criteria.html">Criteria Methods</a>
    <a class="dropdown-item" href="../articles/methods_stat.html">Statistical Methods</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Endpoint Results</h6>
    <a class="dropdown-item" href="../articles/results_datamodel.html">Result Data Model</a>
    <a class="dropdown-item" href="../articles/results_datamodel2tfl.html">Mapping Results to TFLs</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Endpoint Examples</h6>
    <a class="dropdown-item" href="../articles/example_ep_spec.html">Endpoint Catalog</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Debugging</h6>
    <a class="dropdown-item" href="../articles/debugging.html">Debugging</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Development</h6>
    <a class="dropdown-item" href="../articles/dev_git.html">Git Workflow</a>
    <a class="dropdown-item" href="../articles/validation.html">Quality control for ramnog ecosystem</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Criteria Methods</h1>
            
      
      
      <div class="d-none name"><code>methods_criteria.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette provides a short introduction to the idea of analysis
criteria.</p>
<!-- For a more detailed description of how to make new criteria functions, see the companion **{chefcriterion}** package -->
<p>The analysis request from the authorities will detail an overall set
of endpoints, irrespective of the underlying study data. For example,
they might request an analysis of serious adverse events by system organ
class, by gender. Such an analyses may contain many cells with zeros, or
very low counts. To ensure only analyses that contain meaningfully
amounts of data are included, the request may additionally include
certain criteria for the inclusion of an analysis, such as a threshold
for the minimum number of records, events, or subjects.</p>
<p>The logic for these analysis inclusion criteria are handled by the
functions supplied to the <code>crit_endpoint</code>,
<code>crit_by_strata_by_trt</code>, and
<code>crit_by_strata_across_trt</code> arguments when defining an
endpoint in <code>mk_endpoints_str()</code>.</p>
</div>
<div class="section level2">
<h2 id="criteria-levels">Criteria levels<a class="anchor" aria-label="anchor" href="#criteria-levels"></a>
</h2>
<p>Currently, {chef} supports analysis inclusion criteria for three
parts of the analysis output, with colors corresponding to the figure
below:</p>
<ol type="A">
<li>
<span style="background-color: #f7947e">The entire endpoint</span>
</li>
<li>
<span style="background-color: #9fed8c">The
<code>stat_by_strata_by_trt</code></span>
</li>
<li>
<span style="background-color: #03b6fc">The
<code>stat_by_strata_across_trt</code> and
<code>stat_across_strata_across_trt</code></span>
</li>
</ol>
<p><img src="figures/criteria_levels.png" width="100%"></p>
<p>The criteria functions are hierarchical; failure to meet criteria at
Level A (Entire Endpoint) implies automatic failure at Levels B and C.
Similarly, passing Level A but failing Level B results in failure at
Level C.</p>
<p>If an endpoint does not satisfy a certain criterion, the associated
statistical functions will not execute to reduce compute time. For
instance, if an endpoint does not meet the criteria at Level B, by
strata and across treatment arms analyses will not be performed.
However, the analyses for the Totals will still proceed.</p>
<p>It is important to note that these criteria are optional. Not every
endpoint definition needs to incorporate all three levels of criteria.
Some analyses may have no criteria, while others might require criteria
only at the endpoint or strata.</p>
<p><strong>NOTE</strong> that the <code>crit_by_strata_across_trt</code>
criterion gate-keep both <code>stat_by_strata_across_trt</code> and
<code>stat_across_strata_across_trt</code> (stippled box). The
<code>stat_across_strata_across_trt</code> is seen as lower on the
hierarchical criteria ladder than <code>stat_by_strata_across_trt</code>
- however it does not have a seperate criterion at this time and will
therefore be included by default.</p>
<p><img src="figures/criteria_eval.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="function-formals">Function formals<a class="anchor" aria-label="anchor" href="#function-formals"></a>
</h2>
<p>Chef supplies a number of parameters the criterion functions. The
parameters vary according to the statistical method. Note that for
<code>crit_by_strata_by_trt</code>, and
<code>crit_by_strata_across_trt</code> the formals of the functions are
identical.</p>
<div class="section level3 tabset tabset-fade tabset-pills">
<h3 class="tabset tabset-fade tabset-pills" id="input-specifications">Input specifications<a class="anchor" aria-label="anchor" href="#input-specifications"></a>
</h3>
<p>The criteria functions are served broad set of parameters. This
reflects the need for flexibility in the criteria functions.</p>
<p>The flexibility allows you to set criteria that affect specific
stratum based on that specific stratum or on information shared across
multiple strata.</p>
<p>This allows you to create criteria functions which only target one
stratum or act across the whole strata:</p>
<ul>
<li>Criteria1 requires that in the endpoint the strata GENDER must be
balanced. (ie approx 50/50 distribution.) (requires only the
<code>stratify_by</code> parameter)</li>
<li>Criteria2 requires that for the endpoint all strata (GENDER, AGE)
must be balanced. (requires the <code>stratify_by</code> parameter)</li>
<li><em>You may also also design criteria for endpoints, which only
includes in the case where there is enough subjects in relevant
strata.</em></li>
</ul>
<p><em>See <a href="#example-functions">Examples</a></em></p>
<p><em>NB</em> Similar to the stat methods we require that criteria
function include ellipses (<code>...</code>) as a wildcard parameter.
This is both a convenience, since you then only need to explicitly state
the used parameters in your function definition. However, more
importantly it will ensure that a criteria function you define today
will also work tomorrow, where {chef} may supply more parameters to the
criteria functions.</p>


<ul class="nav nav-pills" id="input-specifications" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#endpoint-criteria-functions" id="endpoint-criteria-functions-tab" type="button" role="tab" aria-controls="endpoint-criteria-functions" aria-selected="true" class="active nav-link">endpoint criteria functions</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#strata-criteria-functions" id="strata-criteria-functions-tab" type="button" role="tab" aria-controls="strata-criteria-functions" aria-selected="false" class="nav-link">strata criteria functions</button></li>
</ul>
<div class="tab-content">
<div class="active show fade tab-pane" id="endpoint-criteria-functions" role="tabpanel" aria-labelledby="endpoint-criteria-functions-tab">

<style type="text/css">
  .tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;border-style:solid;border-width:1px;}
  .tg td{background-color:#fff;border-color:#ccc;border-style:solid;border-width:0px;color:#333;
    font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}
  .tg th{background-color:#f0f0f0;border-color:#ccc;border-style:solid;border-width:0px;color:#333;
    font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
  .tg .tg-1wig{font-weight:bold;text-align:left;vertical-align:top}
  .tg .tg-buh4{background-color:#f9f9f9;text-align:left;vertical-align:top}
  .tg .tg-btxf{background-color:#f9f9f9;border-color:inherit;text-align:left;vertical-align:top}
  .tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
  .tg .tg-0lax{text-align:left;vertical-align:top}
</style>
<table class="table tg">
<thead><tr>
<th class="tg-1wig">
Parameter
</th>
<th class="tg-1wig">
Type
</th>
<th class="tg-1wig">
Example
</th>
<th class="tg-1wig">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td class="tg-btxf">
dat
</td>
<td class="tg-btxf">
data.table::data.table
</td>
<td class="tg-buh4">
</td>
<td class="tg-btxf">
Dataset containing the [Analysis population]
(ep_spec_poplation_def.html)
</td>
</tr>
<tr>
<td class="tg-0pky">
event_index,
</td>
<td class="tg-0pky">
List(Integer)
</td>
<td class="tg-0lax">
<code>[1, 3, 5]</code>
</td>
<td class="tg-0pky">
Index (pointing to the <code>INDEX_</code> column) of rows with an <a href="ep_spec_event.html">Event</a>
</td>
</tr>
<tr>
<td class="tg-btxf">
subjectid_var
</td>
<td class="tg-btxf">
Character
</td>
<td class="tg-buh4">
<code>"USUBJID"</code>
</td>
<td class="tg-btxf">
The column containing the subject id.
</td>
</tr>
<tr>
<td class="tg-btxf">
treatment_var,
</td>
<td class="tg-btxf">
Character
</td>
<td class="tg-buh4">
<code>"treatment_name"</code>
</td>
<td class="tg-btxf">
The column name describing treatment type
</td>
</tr>
<tr>
<td class="tg-0pky">
treatment_refval,
</td>
<td class="tg-0pky">
Character
</td>
<td class="tg-0lax">
<code>"Placebo"</code>
</td>
<td class="tg-0pky">
The treatment refval for the <code>treatment_var</code> column for the
endpoint.
</td>
</tr>
<tr>
<td class="tg-btxf">
period_var,
</td>
<td class="tg-btxf">
Character
</td>
<td class="tg-buh4">
<code>"period_block"</code>
</td>
<td class="tg-btxf">
The column name describing the periods
</td>
</tr>
<tr>
<td class="tg-0pky">
period_value,
</td>
<td class="tg-0pky">
Character
</td>
<td class="tg-0lax">
<code>"within_trial_period"</code>
</td>
<td class="tg-0pky">
The value in the <code>period_var</code> which is of interest to the
endpoint.
</td>
</tr>
<tr>
<td class="tg-btxf">
endpoint_filter
</td>
<td class="tg-btxf">
Character (escaped)
</td>
<td class="tg-buh4">
<code>"\"someColumn\" == \"someValue\""</code>
</td>
<td class="tg-btxf">
Specific endpoint filter
</td>
</tr>
<tr>
<td class="tg-0pky">
endpoint_group_metadata
</td>
<td class="tg-0pky">
List
</td>
<td class="tg-0lax">
</td>
<td class="tg-0pky">
Named list containing by_group metadata
</td>
</tr>
<tr>
<td class="tg-btxf">
stratify_by
</td>
<td class="tg-btxf">
List(Character)
</td>
<td class="tg-buh4">
<code>['Sex', 'Gender']</code>
</td>
<td class="tg-btxf">
The <a href="ep_spec_strata_def.html">strata</a> which the endpoint is
sliced by.
</td>
</tr>
</tbody>
</table>
</div>
<div class="fade tab-pane" id="strata-criteria-functions" role="tabpanel" aria-labelledby="strata-criteria-functions-tab">

<style type="text/css">
.tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;border-style:solid;border-width:1px;}
.tg td{background-color:#fff;border-color:#ccc;border-style:solid;border-width:0px;color:#333;
  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{background-color:#f0f0f0;border-color:#ccc;border-style:solid;border-width:0px;color:#333;
  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-1wig{font-weight:bold;text-align:left;vertical-align:top}
.tg .tg-buh4{background-color:#f9f9f9;text-align:left;vertical-align:top}
.tg .tg-btxf{background-color:#f9f9f9;border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-0lax{text-align:left;vertical-align:top}
</style>
<table class="table tg">
<thead><tr>
<th class="tg-1wig">
Parameter
</th>
<th class="tg-1wig">
Type
</th>
<th class="tg-1wig">
Example
</th>
<th class="tg-1wig">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td class="tg-btxf">
dat
</td>
<td class="tg-btxf">
data.table::data.table
</td>
<td class="tg-buh4">
</td>
<td class="tg-btxf">
Dataset containing the <a href="ep_spec_poplation_def.html">Analysis
population</a>
</td>
</tr>
<tr>
<td class="tg-0pky">
event_index,
</td>
<td class="tg-0pky">
List(Integer)
</td>
<td class="tg-0lax">
<code>[1, 3, 5]</code>
</td>
<td class="tg-0pky">
Index (pointing to the <code>INDEX_</code> column) of rows with an <a href="ep_spec_event.html">Event</a>
</td>
</tr>
<tr>
<td class="tg-btxf">
subjectid_var
</td>
<td class="tg-btxf">
Character
</td>
<td class="tg-buh4">
<code>"USUBJID"</code>
</td>
<td class="tg-btxf">
The column containing the subject id.
</td>
</tr>
<tr>
<td class="tg-btxf">
treatment_var,
</td>
<td class="tg-btxf">
Character
</td>
<td class="tg-buh4">
<code>"treatment_name"</code>
</td>
<td class="tg-btxf">
The column name describing treatment type
</td>
</tr>
<tr>
<td class="tg-0pky">
treatment_refval,
</td>
<td class="tg-0pky">
Character
</td>
<td class="tg-0lax">
<code>"Placebo"</code>
</td>
<td class="tg-0pky">
The treatment refval for the <code>treatment_var</code> column for the
endpoint.
</td>
</tr>
<tr>
<td class="tg-btxf">
period_var,
</td>
<td class="tg-btxf">
Character
</td>
<td class="tg-buh4">
<code>"period_block"</code>
</td>
<td class="tg-btxf">
The column name describing the periods
</td>
</tr>
<tr>
<td class="tg-0pky">
period_value,
</td>
<td class="tg-0pky">
Character
</td>
<td class="tg-0lax">
<code>"within_trial_period"</code>
</td>
<td class="tg-0pky">
The value in the <code>period_var</code> which is of interest to the
endpoint.
</td>
</tr>
<tr>
<td class="tg-btxf">
endpoint_filter
</td>
<td class="tg-btxf">
Character (escaped)
</td>
<td class="tg-buh4">
<code>"\"someColumn\" == \"someValue\""</code>
</td>
<td class="tg-btxf">
Specific endpoint filter
</td>
</tr>
<tr>
<td class="tg-0pky">
endpoint_group_metadata
</td>
<td class="tg-0pky">
List
</td>
<td class="tg-0lax">
</td>
<td class="tg-0pky">
Named list containing by_group metadata
</td>
</tr>
<tr>
<td class="tg-btxf">
stratify_by
</td>
<td class="tg-btxf">
List(Character)
</td>
<td class="tg-buh4">
<code>['Sex', 'Gender']</code>
</td>
<td class="tg-btxf">
The <a href="ep_spec_strata_def.html">strata</a> which the endpoint is
sliced by.
</td>
</tr>
<tr>
<td class="tg-0lax">
strata_var
</td>
<td class="tg-0lax">
Character
</td>
<td class="tg-0lax">
<code>"Sex"</code>
</td>
<td class="tg-0lax">
The specific stratification which the criteria relates to.
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level3">
<h3 id="output-specifications">Output specifications<a class="anchor" aria-label="anchor" href="#output-specifications"></a>
</h3>
<p>The output of the criteria function must be a simple
<code>bolean</code> (<code>TRUE</code> or <code>FALSE</code>)</p>
</div>
<div class="section level3 tabset tabset-fade tabset-pills">
<h3 class="tabset tabset-fade tabset-pills" id="example-functions">Example functions<a class="anchor" aria-label="anchor" href="#example-functions"></a>
</h3>
<p>Below are two examples showcasing how to write criteria functions. It
is not within scope of the {chef} package to provide a library of
criteria functions.</p>


<ul class="nav nav-pills" id="example-functions" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#endpoint-criteria-functions-1" id="endpoint-criteria-functions-1-tab" type="button" role="tab" aria-controls="endpoint-criteria-functions-1" aria-selected="true" class="active nav-link">Endpoint criteria functions</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#strata-criteria-functions-1" id="strata-criteria-functions-1-tab" type="button" role="tab" aria-controls="strata-criteria-functions-1" aria-selected="false" class="nav-link">Strata criteria functions</button></li>
</ul>
<div class="tab-content">
<div class="active show fade tab-pane" id="endpoint-criteria-functions-1" role="tabpanel" aria-labelledby="endpoint-criteria-functions-1-tab">

<p>Generic criteria function: Allows control over endpoint inclusion
based on the count of subjects with events in the arms.</p>
<p>This function is a generic that can the be specified in the
mk_endpoint_str or curried beforehand (<a href="methods_stat.html#custom-functions-currying-and-supplying-parameters-">Stat
methods-Currying</a>)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>ep_criteria.treatment_arms_minimum_unique_event_count <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    dat,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    event_index,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    treatment_var,</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    subjectid_var,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    minimum_event_count,</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="at">requirement_type =</span> <span class="fu">c</span>(<span class="st">"any"</span>, <span class="st">"all"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    ...</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    )</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="co"># rows with events</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  dat_events <span class="ot">&lt;-</span> dat[<span class="fu">J</span>(event_index),]</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="co"># Bolean of whether the count of unique subjects </span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="co"># within each treatment arm is above the minimum count.  </span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  dat_lvl_above_threshold <span class="ot">&lt;-</span> dat_events[</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    , </span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    <span class="fu">list</span>(<span class="st">"is_above_minimum"</span> <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">uniqueN</span>(subjectid_var)<span class="sc">&gt;=</span>minimum_event_count), </span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    by<span class="ot">=</span>treatment_var</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>  ]</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>  </span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>  <span class="cf">if</span> requirement_type <span class="sc">==</span> <span class="st">"any"</span><span class="sc">:</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">any</span>(dat_lvl_above_threshold<span class="sc">$</span>V1) )</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">all</span>(dat_lvl_above_threshold<span class="sc">$</span>V1) )</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>  </span></code></pre></div>
</div>
<div class="fade tab-pane" id="strata-criteria-functions-1" role="tabpanel" aria-labelledby="strata-criteria-functions-1-tab">

<p>Only include the across strata and treatment arm analysis if there
are at least X subjects with events in each treatment arm. For
requirement_type==“any” just a single cell (stratum + treatment arm)
needs to be included.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>ep_strata_criteria.strata_treatment_arm_minimum_unique_count <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    dat,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    event_index,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    treatment_var,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    subjectid_var,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    strata_var,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    minimum_event_count,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    <span class="at">requirement_type =</span> <span class="fu">c</span>(<span class="st">"any"</span>, <span class="st">"all"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    ...</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    )</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  <span class="co"># rows with events</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  dat_events <span class="ot">&lt;-</span> dat[<span class="fu">J</span>(event_index),]</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>  <span class="co"># Bolean of whether the count of unique subjects </span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>  <span class="co"># within each treatment arm is above the minimum count.  </span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>  dat_lvl_above_threshold <span class="ot">&lt;-</span> dat_events[</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>    , </span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>    <span class="fu">list</span>(<span class="st">"is_above_minimum"</span> <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">uniqueN</span>(subjectid_var)<span class="sc">&gt;=</span>minimum_event_count), </span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>    by<span class="ot">=</span><span class="fu">c</span>(treatment_var, strata_var)</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>  ]</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>  </span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>  <span class="cf">if</span> requirement_type <span class="sc">==</span> <span class="st">"any"</span><span class="sc">:</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">any</span>(dat_lvl_above_threshold<span class="sc">$</span>is_above_minimum) )</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">all</span>(dat_lvl_above_threshold<span class="sc">$</span>is_above_minimum) )</span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="applying-criteria-functions-">Applying criteria functions.<a class="anchor" aria-label="anchor" href="#applying-criteria-functions-"></a>
</h3>
<p>Criteria functions are supplied to the mk_endpoint_str function and
is used to gatekeep which statistical function are run.</p>
<p>An example of a endpoint could be:</p>
<p>We look at the population with an event E_XYZ.</p>
<ul>
<li>We are only interested in the endpoint if we see at least 5 subjects
in any of the arms that have event E_XYZ.</li>
<li>We are only interested in getting descriptive statistic for any
strata (say GENDER, AGEGRP) if the all levels within have at least 1
subject.</li>
<li>Finally, we only run the across treatment arm statistics if there
are at least 5 subject in each stratum and each treatment arm.</li>
</ul>
<p>The above requirements/gates are implemented by currying the
functions given in the <a href="#examples">Examples</a> section.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># R/project_criteria.R</span></span>
<span><span class="co"># Curry the general criteria functions from [Examples](#examples)</span></span>
<span></span>
<span><span class="va">crit_accept_endpoint.5_subjects_any_treatment_arm</span> <span class="op">&lt;-</span> <span class="va">purrr</span><span class="op">:</span><span class="fu">partial</span><span class="op">(</span></span>
<span>  <span class="va">ep_criteria.treatment_arms_minimum_unique_event_count</span>,</span>
<span>  minimum_event_count <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  requirement_type <span class="op">=</span> <span class="st">"any"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">crit_strata.1_subject_all_treatment_strata</span> <span class="op">&lt;-</span> <span class="va">purrr</span><span class="op">:</span><span class="fu">partial</span><span class="op">(</span></span>
<span>  <span class="va">ep_sg_criteria.sg_treatment_arm_minimum_unique_count</span>,</span>
<span>  minimum_event_count <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  requirement_type <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">crit_strata.5_subject_all_treatment_strata</span> <span class="op">&lt;-</span> <span class="va">purrr</span><span class="op">:</span><span class="fu">partial</span><span class="op">(</span></span>
<span>  <span class="va">ep_sg_criteria.sg_treatment_arm_minimum_unique_count</span>,</span>
<span>  minimum_event_count <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  requirement_type <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R/project_endpoints.R</span></span>
<span></span>
<span><span class="va">endpoint_XYZ</span>  <span class="op">&lt;-</span> <span class="fu">chef</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chef/man/mk_endpoint_str.html" class="external-link">mk_endpoint_str</a></span><span class="op">(</span></span>
<span>  <span class="va">...</span>, <span class="co"># Setting the rest of the inputs</span></span>
<span>  crit_endpoint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">crit_accept_endpoint.5_subjects_any_treatment_arm</span><span class="op">)</span>,</span>
<span>  crit_by_strata_by_trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">crit_strata.1_subject_all_treatment_strata</span><span class="op">)</span>,</span>
<span>  crit_by_strata_across_trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">crit_strata.5_subject_all_treatment_strata</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by MEWP (Matthew David Phelps), NOSJ (Nicolai Skov Johnsen), HSPU (Henrik Sparre Spiegelhauer), CINO (Christian Haargaard Olsen).</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
